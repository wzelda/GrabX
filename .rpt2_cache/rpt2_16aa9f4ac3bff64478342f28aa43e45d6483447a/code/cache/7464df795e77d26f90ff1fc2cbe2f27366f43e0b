{
  "code": "import * as Manager from \"../Manager/Manager\";\r\nimport LocalConfig from '../Config/LocalConfig';\r\nimport * as Config from '../Config/Config';\r\nimport { UIConfig } from \"../Config/UIConfig\";\r\nimport * as Core from \"./Core\";\r\nimport * as Data from \"../Data/Data\";\r\nimport * as Common from \"../Common/Common\";\r\nexport class LoadingProgressController extends Core.Controller {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.Progress = 0;\r\n        this.IsLoaded = false;\r\n        this.PkgNum = 0;\r\n        this.ResNum = 0;\r\n    }\r\n    onOpen(data) {\r\n        this.View.UI.text = \"0%\";\r\n        this.setProgressNumber();\r\n        this.simProgress();\r\n        this.addEventListener(Common.SceneLoginEid.PackageLoaded, this.onResLoaded);\r\n        this.addEventListener(Common.SceneLoginEid.LoginSuccess, this.onLoginSuccess);\r\n        this.addEventListener(Common.SceneLoginEid.ConfigLoaded, this.tryClose);\r\n    }\r\n    setProgressNumber() {\r\n        this.ResNum = Config.loginResUrls.length + Config.urls.length + 5;\r\n        if (Common.isMiniGame()) {\r\n            this.ResNum += UIConfig.SubPkgs.length;\r\n        }\r\n    }\r\n    showUiProgress(progress, pkgName) {\r\n        pkgName = pkgName || '';\r\n        this.View.UI.text = 'Loading ui ' + pkgName + ': ' + progress * 100 + '%';\r\n    }\r\n    simProgress() {\r\n        this.Progress += 100 / this.ResNum;\r\n        let progress = Math.ceil(this.Progress);\r\n        progress = progress > 100 ? 100 : progress;\r\n        this.View.UI.text = progress + \"%\";\r\n        if (this.Progress >= 100) {\r\n            this.tryClose();\r\n            return;\r\n        }\r\n        Laya.timer.once(100, this, this.simProgress);\r\n    }\r\n    addProgress(addProgress) {\r\n        this.Progress += 100 / this.PkgNum;\r\n        console.log(this.Progress);\r\n        let progress = Math.ceil(this.Progress);\r\n        progress = progress > 100 ? 100 : progress;\r\n        this.View.UI.text = progress + \"%\";\r\n        if (this.Progress >= 100) {\r\n            this.IsLoaded = true;\r\n            this.dispatchEvent(Common.SceneLoginEid.PackageLoaded);\r\n            this.showWxLogin();\r\n        }\r\n    }\r\n    showWxLogin() {\r\n        if (!Common.isMiniGame() || LocalConfig.IsWxAuth || !this.IsLoaded)\r\n            return;\r\n        this.View.showWxLogin();\r\n    }\r\n    showConfigProgress() {\r\n        if (Config.DataConfig.IsConfigLoaded == false) {\r\n            this.View.UI.text = \"加载配置中\";\r\n        }\r\n    }\r\n    showLoginProgress() {\r\n        this.View.UI.text = \"登录中\";\r\n    }\r\n    onLoginSuccess() {\r\n        this.tryClose();\r\n    }\r\n    onResLoaded() {\r\n        this.IsLoaded = true;\r\n        this.tryClose();\r\n    }\r\n    tryClose() {\r\n        if (this.Progress < 100)\r\n            return;\r\n        if (Manager.VersionManager.Version == Config.VersionConfig.Develop) {\r\n            if (!LocalConfig.IsChoosedService)\r\n                return;\r\n        }\r\n        if (Config.DataConfig.IsConfigLoaded == false) {\r\n            this.showConfigProgress();\r\n            return;\r\n        }\r\n        if (Data.LoginData.IsLogined != true) {\r\n            this.showLoginProgress();\r\n            return;\r\n        }\r\n        ;\r\n        if (!Config.UIConfig.LoginPackageLoaded)\r\n            return;\r\n        this.close();\r\n    }\r\n    onClose() {\r\n        this.dispatchEvent(Common.SceneLoginEid.SimProgressEnd);\r\n    }\r\n}\r\n",
  "references": [
    "E:/Practise/demo3DLaya/GrabX/src/Manager/Manager.ts",
    "E:/Practise/demo3DLaya/GrabX/src/Config/LocalConfig.ts",
    "E:/Practise/demo3DLaya/GrabX/src/Config/Config.ts",
    "E:/Practise/demo3DLaya/GrabX/src/Config/UIConfig.ts",
    "E:/Practise/demo3DLaya/GrabX/src/UI/Core.ts",
    "E:/Practise/demo3DLaya/GrabX/src/Data/Data.ts",
    "E:/Practise/demo3DLaya/GrabX/src/UI/UI.ts",
    "E:/Practise/demo3DLaya/GrabX/src/Common/Common.ts"
  ]
}
